[gd_scene load_steps=12 format=3 uid="uid://byaivy1i2dr6e"]

[ext_resource type="Texture2D" uid="uid://bpxcnqh5s1xr4" path="res://external_assets/SpaceSkyMap.png" id="2_cqctl"]
[ext_resource type="PackedScene" uid="uid://mcmygip6pg0x" path="res://Ring_Test/ring2.tscn" id="3_q18ps"]
[ext_resource type="Script" path="res://NN.gd" id="4_h7kaq"]
[ext_resource type="ArrayMesh" uid="uid://d2cstfu5u7g54" path="res://external_assets/10475_Rocket_Ship_v1_L3.obj" id="5_3sfx8"]

[sub_resource type="PanoramaSkyMaterial" id="PanoramaSkyMaterial_rmgya"]
panorama = ExtResource("2_cqctl")

[sub_resource type="Sky" id="Sky_tqprb"]
sky_material = SubResource("PanoramaSkyMaterial_rmgya")

[sub_resource type="Environment" id="Environment_3y7q2"]
background_mode = 2
sky = SubResource("Sky_tqprb")

[sub_resource type="GDScript" id="GDScript_7h5lm"]
script/source = "extends RigidBody3D

const THRUST = 50.0
const TURN_ACCELERATION = 25.0

var nn : NN
var bestParticular : NN
var reward : float
var best_reward: float
var target
var next_target

func _ready():
	nn = $NN
	bestParticular = $BestParticular
	reward = 0
	best_reward = -INF
	target = %Ring1
	next_target = %Ring2


func _physics_process(_delta):
#	var input = [linear_velocity.x, linear_velocity.y, linear_velocity.z]
#	input.append_array([angular_velocity.x, angular_velocity.y, angular_velocity.z])
	var relative_pos_1 = quaternion.inverse()*(target.position - position)
#	input.append_array([relative_pos_1.x, relative_pos_1.y, relative_pos_1.z])
	var relative_pos_2 = quaternion*(next_target.position - position)
#	input.append_array([relative_pos_2.x, relative_pos_2.y, relative_pos_2.z])
#
#
#	var output = nn.brain(input)
#	for i in range(output.size()):
#		output[i] = clamp(output[i], -1, 1)
#	apply_central_force(-basis.z * THRUST * (output[0] + 1)/2)
#	var torque = quaternion * Vector3(output[1], output[2], output[3]) * TURN_ACCELERATION
#	apply_torque(torque)
"

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_0otik"]
albedo_color = Color(1, 1, 0.34902, 1)
emission_enabled = true
emission = Color(1, 1, 0.34902, 1)
emission_energy_multiplier = 0.5

[sub_resource type="SphereMesh" id="SphereMesh_p0unw"]
material = SubResource("StandardMaterial3D_0otik")

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_5stq8"]

[node name="space" type="Node3D"]

[node name="Camera3D" type="Camera3D" parent="."]
transform = Transform3D(0.915838, 0, 0.401548, 0, 1, 0, -0.401548, 0, 0.915838, 6.06924, 2.19645, 10.3701)

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(0.875042, -0.418578, 0.24309, 0, 0.502205, 0.864748, -0.484046, -0.756692, 0.439451, 0, 11.0538, 7.25927)

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_3y7q2")

[node name="Ring1" parent="." instance=ExtResource("3_q18ps")]
unique_name_in_owner = true
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 1.17721, 0.351, -2.37806)

[node name="Ring2" parent="." instance=ExtResource("3_q18ps")]
unique_name_in_owner = true
transform = Transform3D(0.949332, 0, 0.314274, 0, 1, 0, -0.314274, 0, 0.949332, -0.966661, 0.47952, -7.25567)

[node name="Spaceship" type="RigidBody3D" parent="."]
collision_mask = 2
inertia = Vector3(1, 1, 1)
script = SubResource("GDScript_7h5lm")

[node name="NN" type="Node" parent="Spaceship"]
script = ExtResource("4_h7kaq")
networkShape = [12, 32, 32, 4]

[node name="BestParticular" type="Node" parent="Spaceship"]
script = ExtResource("4_h7kaq")
networkShape = [12, 32, 32, 4]

[node name="MeshInstance3D" type="MeshInstance3D" parent="Spaceship"]
transform = Transform3D(0.003, 0, 0, 0, -0.003, 4.52987e-10, 0, -4.52987e-10, -0.003, 0, 0, 0.6)
mesh = ExtResource("5_3sfx8")

[node name="Exaust" type="MeshInstance3D" parent="Spaceship"]
transform = Transform3D(0.15, 0, 0, 0, -0.15, 2.26494e-08, 0, -2.26494e-08, -0.15, 0, 0, 0.476049)
mesh = SubResource("SphereMesh_p0unw")
skeleton = NodePath("../MeshInstance3D")

[node name="CollisionShape3D" type="CollisionShape3D" parent="Spaceship"]
transform = Transform3D(0.5, 0, 0, 0, -2.18557e-08, -0.5, 0, 0.5, -2.18557e-08, 0, 0, 0)
shape = SubResource("CapsuleShape3D_5stq8")
